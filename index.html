<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refresquer√≠a EL PORTON</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header M√≥vil -->
    <header class="mobile-header">
        <div class="header-left">
            <button id="menu-toggle" class="menu-toggle" aria-label="Abrir men√∫">‚ò∞</button>
            <h1 class="site-title">EL PORTON</h1>
        </div>
        <div class="header-right">
            <div class="theme-toggle">
                <div class="theme-switch">
                    <input type="checkbox" id="theme-toggle" aria-label="Cambiar tema">
                    <label for="theme-toggle" class="theme-switch-label" title="Cambiar tema"></label>
                </div>
                <span id="theme-label" class="theme-label">Claro</span>
            </div>
            <button id="ver-carrito" class="cart-btn-mobile">
                üõí <span id="cart-count" class="cart-count">0</span>
            </button>
        </div>
    </header>

    <!-- Contenido Principal -->
    <div class="main-container">
        <!-- Sidebar de Navegaci√≥n -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Men√∫ Principal</h2>
            </div>
            <div class="menu-items">
                <button class="menu-item active" onclick="showCategory('inicio')">
                    <span class="menu-icon">üè†</span>
                    <span class="menu-text">Inicio</span>
                </button>
                <button class="menu-item" onclick="showCategory('refrescos')">
                    <span class="menu-icon">ü•§</span>
                    <span class="menu-text">Refrescos</span>
                </button>
                <button class="menu-item" onclick="showCategory('snacks')">
                    <span class="menu-icon">üçø</span>
                    <span class="menu-text">Snacks</span>
                </button>
                <button class="menu-item" onclick="showCategory('dulces')">
                    <span class="menu-icon">üç¨</span>
                    <span class="menu-text">Dulces</span>
                </button>
                <button class="menu-item" onclick="showCategory('contacto')">
                    <span class="menu-icon">üìû</span>
                    <span class="menu-text">Contacto</span>
                </button>
                <button class="menu-item" onclick="showCategory('sobre')">
                    <span class="menu-icon">‚ÑπÔ∏è</span>
                    <span class="menu-text">Sobre Nosotros</span>
                </button>
            </div>
        </nav>

        <!-- Contenido Principal -->
        <main class="content-area">
            <div class="content-header">
                <h2 class="page-title" id="page-title">Bienvenido a Refresquer√≠a EL PORTON</h2>
            </div>
            
            <section class="products-section">
                <div id="products-container" class="products-container">
                    <!-- Contenido din√°mico se carga aqu√≠ -->
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de Completar Pedido -->
    <div id="modal-datos" class="modal-pedido">
        <div class="modal-pedido-content">
            <div class="modal-pedido-header">
                <h3>Completar Pedido</h3>
                <button type="button" id="cancelar-datos" class="modal-pedido-close">
                    √ó
                </button>
            </div>
            
            <form id="form-datos" class="modal-pedido-form">
                <div class="form-group-pedido">
                    <label for="input-nombre" class="form-label-pedido">
                        Nombre completo *
                    </label>
                    <input 
                        type="text" 
                        id="input-nombre" 
                        name="nombre" 
                        class="form-input-pedido" 
                        required 
                        placeholder="Ingresa tu nombre completo"
                    >
                    <span id="error-nombre" class="error-message-pedido"></span>
                </div>
                
                <div class="form-group-pedido">
                    <label for="input-correo" class="form-label-pedido">
                        Correo electr√≥nico *
                    </label>
                    <input 
                        type="email" 
                        id="input-correo" 
                        name="correo" 
                        class="form-input-pedido" 
                        required 
                        placeholder="ejemplo@correo.com"
                    >
                    <span id="error-correo" class="error-message-pedido"></span>
                </div>
                
                <div class="modal-pedido-actions">
                    <button type="button" id="cancelar-pedido" class="btn btn-cancelar-pedido">
                        Cancelar
                    </button>
                    <button type="submit" id="guardar-datos" class="btn btn-confirmar-pedido">
                        Confirmar Pedido
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Panel del Carrito -->
    <div id="cart-backdrop" class="cart-backdrop"></div>
    <aside id="cart-panel" class="cart-panel">
        <div class="cart-header">
            <h3>Tu Carrito de Compras</h3>
            <button id="close-cart" class="close-cart" aria-label="Cerrar carrito">√ó</button>
        </div>
        <div class="cart-content">
            <div id="cart-items" class="cart-items">
                <!-- Items del carrito se cargan aqu√≠ -->
            </div>
            <div class="cart-summary">
                <div class="cart-total">
                    <span>Total:</span>
                    <strong id="cart-total">$0.00</strong>
                </div>
                <div class="cart-actions">
                    <button id="vaciar-carrito" class="btn btn-outline">Vaciar Carrito</button>
                    <button id="pagar-carrito" class="btn btn-primary">Procesar Pago</button>
                </div>
            </div>
        </div>
    </aside>

    <!-- JavaScript -->
    <script>
        // Configuraci√≥n de productos
        const products = {
            refrescos: [
                {name: "Coca Cola", price: "$20.00", img: "Cocacola.jpeg", category: "Bebidas"},
                {name: "Sangr√≠a", price: "$20.00", img: "Sangria.jpeg", category: "Bebidas"},
                {name: "Sprite", price: "$20.00", img: "Sprite.jpeg", category: "Bebidas"},
            ],
            snacks: [
                {name: "Tostitos Preparados", price: "$50.00", img: "Tostitos_prep.jpeg", category: "Snacks"},
                {name: "Pepihuates", price: "$25.00", img: "Pepihuates.jpeg", category: "Snacks"},
            ],
            dulces: [
                {name: "Chocolate", price: "$8.00", img: "Chocolate.jpeg", category: "Dulces"},
                {name: "Gomitas", price: "$7.00", img: "Gomitas.jpeg", category: "Dulces"},
            ],
            contacto: [
                {name: "Tel√©fono: 123-456-789", price: "", img: null, type: "contacto"},
                {name: "Correo: info@refresqueria.com", price: "", img: null, type: "contacto"},
                {name: "Direcci√≥n: Av. Principal #123", price: "", img: null, type: "contacto"},
            ],
            sobre: [
                {name: "Somos una refresquer√≠a familiar dedicada a ofrecer los mejores productos frescos y deliciosos.", price: "", img: null, type: "info"},
                {name: "Horario: Lunes a Domingo 8:00 AM - 10:00 PM", price: "", img: null, type: "info"},
                {name: "¬°Vis√≠tanos y descubre por qu√© somos los favoritos del barrio!", price: "", img: null, type: "info"},
            ]
        };

        // Sistema del Carrito
        let carrito = JSON.parse(localStorage.getItem('carrito')) || [];

        function guardarCarrito() {
            localStorage.setItem('carrito', JSON.stringify(carrito));
            actualizarContadorCarrito();
        }

        function agregarAlCarrito(producto) {
            const productoExistente = carrito.find(item => item.name === producto.name);
            
            if (productoExistente) {
                productoExistente.cantidad += 1;
            } else {
                carrito.push({
                    ...producto,
                    cantidad: 1
                });
            }
            
            guardarCarrito();
            actualizarPanelCarrito();
            mostrarNotificacion('Producto agregado al carrito');
        }

        function quitarDelCarrito(nombreProducto) {
            carrito = carrito.filter(item => item.name !== nombreProducto);
            guardarCarrito();
            actualizarPanelCarrito();
        }

        function actualizarCantidad(nombreProducto, cambio) {
            const producto = carrito.find(item => item.name === nombreProducto);
            if (producto) {
                producto.cantidad += cambio;
                if (producto.cantidad <= 0) {
                    quitarDelCarrito(nombreProducto);
                } else {
                    guardarCarrito();
                    actualizarPanelCarrito();
                }
            }
        }

        function actualizarContadorCarrito() {
            const totalItems = carrito.reduce((total, item) => total + item.cantidad, 0);
            document.getElementById('cart-count').textContent = totalItems;
        }

        function actualizarPanelCarrito() {
            const contenedorItems = document.getElementById('cart-items');
            const totalElemento = document.getElementById('cart-total');
            
            let total = 0;
            contenedorItems.innerHTML = '';

            if (carrito.length === 0) {
                contenedorItems.innerHTML = `
                    <div class="empty-cart">
                        <span>üõí</span>
                        <p>Tu carrito est√° vac√≠o</p>
                        <small>Agrega productos desde el men√∫</small>
                    </div>
                `;
            } else {
                carrito.forEach(item => {
                    const precioNumerico = parseFloat(item.price.replace('$', '')) || 0;
                    const subtotal = precioNumerico * item.cantidad;
                    total += subtotal;

                    const elementoItem = document.createElement('div');
                    elementoItem.className = 'cart-item';
                    elementoItem.innerHTML = `
                        <div class="cart-item-info">
                            <h4>${item.name}</h4>
                            <span class="cart-item-price">${item.price}</span>
                        </div>
                        <div class="cart-item-controls">
                            <div class="quantity-controls">
                                <button class="qty-btn" onclick="actualizarCantidad('${item.name}', -1)">‚àí</button>
                                <span class="quantity">${item.cantidad}</span>
                                <button class="qty-btn" onclick="actualizarCantidad('${item.name}', 1)">+</button>
                            </div>
                            <button class="remove-btn" onclick="quitarDelCarrito('${item.name}')">
                                üóëÔ∏è
                            </button>
                        </div>
                        <div class="cart-item-subtotal">
                            $${subtotal.toFixed(2)}
                        </div>
                    `;
                    contenedorItems.appendChild(elementoItem);
                });
            }

            totalElemento.textContent = `$${total.toFixed(2)}`;
            actualizarContadorCarrito();
        }

        // Sistema de Navegaci√≥n
        function showCategory(categoria) {
            const contenedor = document.getElementById('products-container');
            const tituloPagina = document.getElementById('page-title');
            
            // Actualizar men√∫ activo
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            contenedor.innerHTML = '';
            
            if (categoria === 'inicio') {
                mostrarVistaInicio(contenedor);
                tituloPagina.textContent = 'Bienvenido a EL PORTON';
            } else if (products[categoria]) {
                tituloPagina.textContent = categoria.charAt(0).toUpperCase() + categoria.slice(1);
                if (categoria === 'contacto' || categoria === 'sobre') {
                    mostrarInformacion(contenedor, products[categoria]);
                } else {
                    mostrarProductos(contenedor, products[categoria]);
                }
            }
            
            // Cerrar sidebar en m√≥viles
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        function mostrarVistaInicio(contenedor) {
            contenedor.innerHTML = `
                <div class="welcome-hero">
                    <div class="hero-content">
                        <h1>Bienvenido a Refresquer√≠a</h1>
                        <h2>EL PORTON</h2>
                        <p class="hero-description">
                            Somos una refresquer√≠a familiar. Explora nuestras categor√≠as desde la barra lateral 
                            y agrega tus productos favoritos al carrito.
                        </p>
                        <p>Puedes ver nuestras promociones y novedades aqu√≠.</p>
                    </div>
                </div>
            `;
        }

        function mostrarProductos(contenedor, productos) {
            if (productos.length === 0) {
                contenedor.innerHTML = '<div class="empty-state">No hay productos disponibles en esta categor√≠a.</div>';
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'products-grid';
            
            productos.forEach(producto => {
                const tarjeta = document.createElement('div');
                tarjeta.className = 'product-card';
                tarjeta.innerHTML = `
                    ${producto.img ? `
                        <div class="product-image">
                            <img src="${producto.img}" alt="${producto.name}" loading="lazy">
                        </div>
                    ` : ''}
                    <div class="product-info">
                        <h3 class="product-name">${producto.name}</h3>
                        <div class="product-price">${producto.price}</div>
                        <button class="add-to-cart-btn" onclick="agregarAlCarrito(${JSON.stringify(producto).replace(/"/g, '&quot;')})">
                            üõí Agregar al Carrito
                        </button>
                    </div>
                `;
                grid.appendChild(tarjeta);
            });
            
            contenedor.appendChild(grid);
        }

        function mostrarInformacion(contenedor, informacion) {
            const lista = document.createElement('div');
            lista.className = 'info-list';
            
            informacion.forEach(item => {
                const elemento = document.createElement('div');
                elemento.className = 'info-item';
                elemento.innerHTML = `
                    <div class="info-content">
                        <p>${item.name}</p>
                    </div>
                `;
                lista.appendChild(elemento);
            });
            
            contenedor.appendChild(lista);
        }

        // Sistema de Modal de Pedido
        function mostrarModalPedido() {
            if (carrito.length === 0) {
                mostrarNotificacion('El carrito est√° vac√≠o');
                return;
            }
            
            // Resetear formulario
            document.getElementById('input-nombre').value = '';
            document.getElementById('input-correo').value = '';
            document.getElementById('error-nombre').textContent = '';
            document.getElementById('error-correo').textContent = '';
            
            // Mostrar modal
            document.getElementById('modal-datos').classList.add('active');
            
            // Enfocar primer campo
            setTimeout(() => {
                document.getElementById('input-nombre').focus();
            }, 300);
        }

        function cerrarModalPedido() {
            document.getElementById('modal-datos').classList.remove('active');
        }

        function procesarPedido(e) {
            e.preventDefault();
            
            const nombre = document.getElementById('input-nombre').value.trim();
            const correo = document.getElementById('input-correo').value.trim();
            let valido = true;
            
            // Resetear errores
            document.getElementById('error-nombre').textContent = '';
            document.getElementById('error-correo').textContent = '';
            
            // Validar nombre
            if (!nombre) {
                document.getElementById('error-nombre').textContent = 'El nombre es obligatorio';
                valido = false;
            } else if (nombre.length < 2) {
                document.getElementById('error-nombre').textContent = 'El nombre debe tener al menos 2 caracteres';
                valido = false;
            }
            
            // Validar correo
            if (!correo) {
                document.getElementById('error-correo').textContent = 'El correo electr√≥nico es obligatorio';
                valido = false;
            } else if (!/^\S+@\S+\.\S+$/.test(correo)) {
                document.getElementById('error-correo').textContent = 'Ingresa un correo electr√≥nico v√°lido';
                valido = false;
            }
            
            if (!valido) return;
            
            // Calcular total
            const total = carrito.reduce((sum, item) => {
                const precio = parseFloat(item.price.replace('$', '')) || 0;
                return sum + (precio * item.cantidad);
            }, 0);
            
            // Preparar datos para Firebase
            const datosPedido = {
                nombre: nombre,
                correo: correo,
                productos: carrito.map(item => ({
                    nombre: item.name,
                    cantidad: item.cantidad,
                    precio: item.price
                })),
                total: total.toFixed(2),
                fecha: firebase.firestore.FieldValue.serverTimestamp(),
                estado: 'pendiente'
            };
            
            // Mostrar loading
            const btnConfirmar = document.getElementById('guardar-datos');
            const textoOriginal = btnConfirmar.textContent;
            btnConfirmar.textContent = 'Procesando...';
            btnConfirmar.disabled = true;
            
            // Guardar en Firebase
            db.collection("pedidos").add(datosPedido)
                .then(() => {
                    mostrarNotificacion('¬°Pedido realizado con √©xito! Te contactaremos pronto.');
                    carrito = [];
                    guardarCarrito();
                    actualizarPanelCarrito();
                    cerrarModalPedido();
                    document.getElementById('form-datos').reset();
                })
                .catch(error => {
                    console.error("Error guardando pedido:", error);
                    mostrarNotificacion('Error al procesar el pedido. Intenta nuevamente.');
                })
                .finally(() => {
                    btnConfirmar.textContent = textoOriginal;
                    btnConfirmar.disabled = false;
                });
        }

        function mostrarNotificacion(mensaje, tipo = 'success') {
            const notificacion = document.createElement('div');
            notificacion.className = `notification ${tipo}`;
            notificacion.textContent = mensaje;
            
            // Estilos para la notificaci√≥n
            notificacion.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: ${tipo === 'error' ? '#dc3545' : 'var(--primary)'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: var(--shadow);
                z-index: 5000;
                transform: translateX(400px);
                transition: transform 0.3s ease;
                font-weight: 500;
                max-width: 300px;
            `;
            
            document.body.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notificacion.style.transform = 'translateX(400px)';
                setTimeout(() => {
                    if (document.body.contains(notificacion)) {
                        document.body.removeChild(notificacion);
                    }
                }, 300);
            }, 4000);
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar vista de inicio
            showCategory('inicio');
            actualizarContadorCarrito();
            
            // Menu toggle para m√≥viles
            document.getElementById('menu-toggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('active');
            });
            
            // Carrito toggle
            document.getElementById('ver-carrito').addEventListener('click', function() {
                document.getElementById('cart-panel').classList.add('active');
                document.getElementById('cart-backdrop').classList.add('active');
                actualizarPanelCarrito();
            });
            
            // Cerrar carrito
            document.getElementById('close-cart').addEventListener('click', cerrarCarrito);
            document.getElementById('cart-backdrop').addEventListener('click', cerrarCarrito);
            
            function cerrarCarrito() {
                document.getElementById('cart-panel').classList.remove('active');
                document.getElementById('cart-backdrop').classList.remove('active');
            }
            
            // Vaciar carrito
            document.getElementById('vaciar-carrito').addEventListener('click', function() {
                if (carrito.length > 0) {
                    if (confirm('¬øEst√°s seguro de que quieres vaciar el carrito?')) {
                        carrito = [];
                        guardarCarrito();
                        actualizarPanelCarrito();
                        mostrarNotificacion('Carrito vaciado');
                    }
                }
            });
            
            // Procesar pago
            document.getElementById('pagar-carrito').addEventListener('click', mostrarModalPedido);
            
            // Modal de datos
            document.getElementById('cancelar-datos').addEventListener('click', cerrarModalPedido);
            document.getElementById('cancelar-pedido').addEventListener('click', cerrarModalPedido);
            
            // Cerrar modal al hacer clic fuera
            document.getElementById('modal-datos').addEventListener('click', function(e) {
                if (e.target === this) {
                    cerrarModalPedido();
                }
            });
            
            // Cerrar modal con Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && document.getElementById('modal-datos').classList.contains('active')) {
                    cerrarModalPedido();
                }
            });
            
            // Enviar formulario
            document.getElementById('form-datos').addEventListener('submit', procesarPedido);
            
            // Cerrar men√∫ al hacer clic fuera en m√≥viles
            document.addEventListener('click', function(e) {
                const sidebar = document.getElementById('sidebar');
                const menuToggle = document.getElementById('menu-toggle');
                
                if (window.innerWidth <= 768 && 
                    sidebar.classList.contains('active') &&
                    !sidebar.contains(e.target) && 
                    e.target !== menuToggle) {
                    sidebar.classList.remove('active');
                }
            });
        });

        // Tema oscuro/claro
        (function(){
            const input = document.getElementById('theme-toggle');
            const root = document.documentElement;
            const label = document.getElementById('theme-label');
            if(!input || !label) return;
            const stored = localStorage.getItem('theme');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

            function setLabel(theme) {
                label.textContent = theme === 'dark' ? 'Oscuro' : 'Claro';
            }
            const applyTheme = (theme)=>{
                root.classList.remove('dark','light');
                if(theme === 'dark'){
                    root.classList.add('dark');
                    input.checked = true;
                }
                else if(theme === 'light'){
                    root.classList.add('light');
                    input.checked = false;
                }
                setLabel(theme);
            };

            if(stored === 'dark' || stored === 'light') applyTheme(stored);
            else applyTheme(prefersDark ? 'dark' : 'light');

            input.addEventListener('change', ()=>{
                const newTheme = input.checked ? 'dark' : 'light';
                applyTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });
        })();
    </script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAK2ex1uACVSPo_fxlgN_iDBAWlsBvV4RM",
            authDomain: "refresqueriaporton.firebaseapp.com",
            projectId: "refresqueriaporton",
            storageBucket: "refresqueriaporton.firebasestorage.app",
            messagingSenderId: "608366778564",
            appId: "1:608366778564:web:39cf58eb7802c1e0189191",
            measurementId: "G-LW73YBZVPF"
        };

        if(!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
    </script>
</body>
</html>
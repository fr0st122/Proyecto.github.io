<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Refresquer√≠a EL PORTON</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Contenido principal -->
<div id="main-content">
  <div class="sidebar">
    <h2>Men√∫</h2>
  <div class="menu-item" onclick="showCategory('inicio')">üè†<span class="text">Inicio</span></div>
    <div class="menu-item" onclick="showCategory('refrescos')">ü•§<span class="text">Refrescos</span></div>
    <div class="menu-item" onclick="showCategory('snacks')">üçø<span class="text">Snacks</span></div>
    <div class="menu-item" onclick="showCategory('dulces')">üç¨<span class="text">Dulces</span></div>
    <div class="menu-item" onclick="showCategory('contacto')">üìû<span class="text">Contacto</span></div>
    <div class="menu-item" onclick="showCategory('sobre')">‚ÑπÔ∏è<span class="text">Sobre Nosotros</span></div>
  </div>

  <div class="content">
    <header class="page-header">
      <button id="menu-toggle" class="menu-toggle" aria-label="Abrir men√∫">‚ò∞</button>
      <h1 class="category-title">Bienvenido a Refresquer√≠a Deliciosa</h1>
      <div class="header-actions" style="display:flex;gap:8px;align-items:center">
        <div class="theme-toggle">
          <div class="theme-switch">
            <input type="checkbox" id="theme-toggle" aria-label="Cambiar tema">
            <label for="theme-toggle" class="theme-switch-label" title="Cambiar tema"></label>
          </div>
        </div>
        <div class="cart-toggle">
          <button id="ver-carrito">üõí Ver Carrito (<span id="cart-count">0</span>)</button>
        </div>
      </div>
    </header>

    <!-- Navegaci√≥n por categor√≠as desde el sidebar -->

    <div class="products" id="products-container">
      <p>Selecciona una categor√≠a para ver los productos o informaci√≥n.</p>
    </div>
  </div>

  <!-- Panel de carrito -->
  <div id="cart-backdrop" class="cart-backdrop" aria-hidden="true"></div>
  <aside id="cart-panel" class="cart-panel" aria-hidden="true">
    <div class="cart-header">
      <h2>Tu Carrito</h2>
      <button id="close-cart" class="close-cart" aria-label="Cerrar carrito">‚úñ</button>
    </div>
    <div id="cart-items"></div>
    <div class="cart-footer">
      <p>Total: <strong id="cart-total">$0.00</strong></p>
      <button id="vaciar-carrito">Vaciar carrito</button>
      <button id="pagar-carrito">Pagar (simulado)</button>
    </div>
  </aside>
</div>

<script>
const products = {
  refrescos: [
    {name: "Cocacola", price: "$20.00", img: ""},
    {name: "Sangria", price: "$20.00", img: ""},
    {name: "Sprite", price: "$20.00", img: ""},
  ],
  snacks: [
    {name: "Tostitos preparados", price: "$50.00", img: ""},
    {name: "Pepihuates", price: "$25.00", img: ""},
  ],
  dulces: [
    {name: "Chocolate", price: "$8.00", img: ""},
    {name: "Gomitas", price: "$7.00", img: ""},
  ],
  contacto: [
    {name: "Tel√©fono: 123-456-789", price: "", img: null},
    {name: "Correo: info@refresqueria.com", price: "", img: null},
  ],
  sobre: [
    {name: "Somos una refresquer√≠a familiar dedicada a ofrecer los mejores productos frescos y deliciosos.", price: "", img: null},
  ]
};

// Carrito en memoria y persistencia
let carrito = JSON.parse(localStorage.getItem('carrito') || '[]');

function guardarCarrito() {
  localStorage.setItem('carrito', JSON.stringify(carrito));
  actualizarContador();
}

function agregarAlCarrito(item) {
  const existente = carrito.find(i => i.name === item.name);
  if(existente) {
    existente.qty += 1;
  } else {
    carrito.push({...item, qty: 1});
  }
  guardarCarrito();
  actualizarPanelCarrito();
}

function quitarDelCarrito(name) {
  carrito = carrito.filter(i => i.name !== name);
  guardarCarrito();
  actualizarPanelCarrito();
}

function cambiarCantidad(name, delta) {
  const item = carrito.find(i => i.name === name);
  if(!item) return;
  item.qty += delta;
  if(item.qty <= 0) quitarDelCarrito(name);
  guardarCarrito();
  actualizarPanelCarrito();
}

function actualizarContador() {
  const count = carrito.reduce((s, i) => s + i.qty, 0);
  const counterEl = document.getElementById('cart-count');
  if(counterEl) counterEl.textContent = count;
}

function actualizarPanelCarrito() {
  const container = document.getElementById('cart-items');
  if(!container) return;
  container.innerHTML = '';
  let total = 0;
  if(carrito.length === 0) {
    container.innerHTML = '<p>El carrito est√° vac√≠o.</p>';
  } else {
    carrito.forEach(i => {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'cart-item';
      const priceNum = parseFloat((i.price || '').replace(/[^0-9.-]+/g, '')) || 0;
      total += priceNum * i.qty;
      itemDiv.innerHTML = `
        <div class="cart-item-info">
          <strong>${i.name}</strong>
          <p>${i.price} x ${i.qty}</p>
        </div>
        <div class="cart-item-actions">
          <button data-name="${i.name}" class="qty-minus">-</button>
          <button data-name="${i.name}" class="qty-plus">+</button>
          <button data-name="${i.name}" class="remove-item">Eliminar</button>
        </div>
      `;
      container.appendChild(itemDiv);
    });
  }
  const totalEl = document.getElementById('cart-total');
  if(totalEl) totalEl.textContent = '$' + total.toFixed(2);
  actualizarContador();
}

function showCategory(category) {
  const container = document.getElementById("products-container");
  if(!container) return;
  container.innerHTML = "";
  if(category === "contacto" || category === "sobre"){
    container.classList.add("vertical");
  } else {
    container.classList.remove("vertical");
  }

  // Vista especial de inicio (bienvenida) - no agregar botones de carrito aqu√≠
  if(category === 'inicio'){
    const welcome = document.createElement('div');
    welcome.className = 'welcome';
    welcome.innerHTML = `
      <h2>Bienvenido a Refresquer√≠a EL PORTON</h2>
      <p>Somos una refresquer√≠a familiar. Explora nuestras categor√≠as desde la barra lateral y agrega tus productos favoritos al carrito.</p>
      <p>Puedes ver nuestras promociones y novedades aqu√≠.</p>
    `;
    container.appendChild(welcome);
    const titleEl = document.querySelector(".category-title");
    if(titleEl) titleEl.textContent = 'Inicio';
    return;
  }

  if(products[category]) {
    products[category].forEach(product => {
      const card = document.createElement("div");
      card.classList.add("product-card");

      let imgHTML = "";
      if(product.img) {
        imgHTML = `<img src="${product.img}" alt="${product.name}">`;
      }

      card.innerHTML = `
        ${imgHTML}
        <h3>${product.name}</h3>
        <p>${product.price}</p>
      `;
      // Si el producto tiene precio, agregamos bot√≥n para a√±adir al carrito
      if(product.price) {
        const btn = document.createElement('button');
        btn.textContent = 'Agregar al carrito';
        btn.addEventListener('click', () => agregarAlCarrito(product));
        card.appendChild(btn);
      }
      container.appendChild(card);
    });
  } else {
    container.innerHTML = "<p>No hay informaci√≥n disponible.</p>";
  }
  const titleEl = document.querySelector(".category-title");
  if(titleEl) titleEl.textContent = category.charAt(0).toUpperCase() + category.slice(1);
}

document.addEventListener('DOMContentLoaded', () => {
  // Mobile menu toggle
  const menuToggle = document.getElementById('menu-toggle');
  const sidebar = document.querySelector('.sidebar');
  if(menuToggle && sidebar){
    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('open');
    });
    // close when clicking outside on mobile
    document.addEventListener('click', (e)=>{
      if(window.innerWidth <= 800 && sidebar.classList.contains('open')){
        if(!sidebar.contains(e.target) && e.target !== menuToggle){
          sidebar.classList.remove('open');
        }
      }
    });
  }
  const verCarritoBtn = document.getElementById('ver-carrito');
  if(verCarritoBtn) {
    verCarritoBtn.addEventListener('click', () => {
      const panel = document.getElementById('cart-panel');
      const backdrop = document.getElementById('cart-backdrop');
      if(panel) {
        const open = panel.classList.toggle('open');
        panel.setAttribute('aria-hidden', open ? 'false' : 'true');
        if(backdrop) {
          if(open) { backdrop.classList.add('visible'); backdrop.setAttribute('aria-hidden','false'); }
          else { backdrop.classList.remove('visible'); backdrop.setAttribute('aria-hidden','true'); }
        }
      }
      actualizarPanelCarrito();
    });
  }

  const vaciarBtn = document.getElementById('vaciar-carrito');
  if(vaciarBtn) {
    vaciarBtn.addEventListener('click', () => {
      carrito = [];
      guardarCarrito();
      actualizarPanelCarrito();
    });
  }

  const pagarBtn = document.getElementById('pagar-carrito');
  if(pagarBtn) {
    pagarBtn.addEventListener('click', () => {
      if(carrito.length === 0) { alert('El carrito est√° vac√≠o.'); return; }
      alert('Pago simulado. Gracias por tu compra.');
      carrito = [];
      guardarCarrito();
      actualizarPanelCarrito();
    });
  }

  // Delegaci√≥n para botones dentro del panel del carrito
  document.getElementById('cart-items')?.addEventListener('click', (e) => {
    const target = e.target;
    if(target.classList.contains('qty-minus')) {
      cambiarCantidad(target.dataset.name, -1);
    } else if(target.classList.contains('qty-plus')) {
      cambiarCantidad(target.dataset.name, 1);
    } else if(target.classList.contains('remove-item')) {
      quitarDelCarrito(target.dataset.name);
    }
  });

  // Close button inside cart
  const closeCartBtn = document.getElementById('close-cart');
  const backdrop = document.getElementById('cart-backdrop');
  if(closeCartBtn) closeCartBtn.addEventListener('click', () => {
    const panel = document.getElementById('cart-panel');
    if(panel) { panel.classList.remove('open'); panel.setAttribute('aria-hidden','true'); }
    if(backdrop) { backdrop.classList.remove('visible'); backdrop.setAttribute('aria-hidden','true'); }
  });

  // Click on backdrop closes
  if(backdrop) {
    backdrop.addEventListener('click', () => {
      const panel = document.getElementById('cart-panel');
      if(panel) { panel.classList.remove('open'); panel.setAttribute('aria-hidden','true'); }
      backdrop.classList.remove('visible');
      backdrop.setAttribute('aria-hidden','true');
    });
  }

  // Escape to close
  document.addEventListener('keydown', (e) => {
    if(e.key === 'Escape'){
      const panel = document.getElementById('cart-panel');
      if(panel && panel.classList.contains('open')){
        panel.classList.remove('open');
        panel.setAttribute('aria-hidden','true');
      }
    }
  });

  // Inicializar vista de inicio por defecto
  showCategory('inicio');
  actualizarPanelCarrito();
});
</script>

<script>
// Theme toggle: persist preference and apply dark class
(function(){
  const input = document.getElementById('theme-toggle');
  const root = document.documentElement;
  if(!input) return;
  const stored = localStorage.getItem('theme');
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

  const applyTheme = (theme)=>{
    root.classList.remove('dark','light');
    if(theme === 'dark'){
      root.classList.add('dark');
      input.checked = true;
    }
    else if(theme === 'light'){
      root.classList.add('light');
      input.checked = false;
    }
  };

  // Initialize: stored preference overrides system; otherwise follow system
  if(stored === 'dark' || stored === 'light') applyTheme(stored);
  else applyTheme(prefersDark ? 'dark' : 'light');

  input.addEventListener('change', ()=>{
    const newTheme = input.checked ? 'dark' : 'light';
    applyTheme(newTheme);
    localStorage.setItem('theme', newTheme);
  });
})();
</script>

</body>
</html>

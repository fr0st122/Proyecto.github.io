<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refresquer√≠a EL PORTON</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header M√≥vil Optimizado -->
<header class="mobile-header">
    <div class="header-left">
        <button id="menu-toggle" class="menu-toggle" aria-label="Abrir men√∫">‚ò∞</button>
        <h1 class="site-title">EL PORTON</h1>
    </div>
    <div class="header-right">
        <div class="theme-toggle">
            <div class="theme-switch">
                <input type="checkbox" id="theme-toggle" aria-label="Cambiar tema">
                <label for="theme-toggle" class="theme-switch-label" title="Cambiar tema"></label>
            </div>
            <span id="theme-label" class="theme-label">Claro</span>
        </div>
        <button id="ver-carrito" class="cart-btn-mobile">
            üõí <span id="cart-count" class="cart-count">0</span>
        </button>
    </div>
</header>
    <!-- Contenido Principal -->
    <div class="main-container">
        <!-- Sidebar de Navegaci√≥n -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Men√∫ Principal</h2>
            </div>
            <div class="menu-items">
                <button class="menu-item active" onclick="showCategory('inicio')">
                    <span class="menu-icon">üè†</span>
                    <span class="menu-text">Inicio</span>
                </button>
                <button class="menu-item" onclick="showCategory('refrescos')">
                    <span class="menu-icon">ü•§</span>
                    <span class="menu-text">Refrescos</span>
                </button>
                <button class="menu-item" onclick="showCategory('snacks')">
                    <span class="menu-icon">üçø</span>
                    <span class="menu-text">Snacks</span>
                </button>
                <button class="menu-item" onclick="showCategory('dulces')">
                    <span class="menu-icon">üç¨</span>
                    <span class="menu-text">Dulces</span>
                </button>
                <button class="menu-item" onclick="showCategory('contacto')">
                    <span class="menu-icon">üìû</span>
                    <span class="menu-text">Contacto</span>
                </button>
                <button class="menu-item" onclick="showCategory('sobre')">
                    <span class="menu-icon">‚ÑπÔ∏è</span>
                    <span class="menu-text">Sobre Nosotros</span>
                </button>
            </div>
        </nav>

        <!-- Contenido Principal -->
        <main class="content-area">
            <div class="content-header">
                <h2 class="page-title" id="page-title">Bienvenido a Refresquer√≠a EL PORTON</h2>
            </div>
            
            <section class="products-section">
                <div id="products-container" class="products-container">
                    <!-- Contenido din√°mico se carga aqu√≠ -->
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de Datos del Cliente -->
    <div id="modal-datos" class="modal">
        <div class="modal-overlay" id="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Completar Pedido</h3>
                <button class="modal-close" id="cancelar-datos">√ó</button>
            </div>
            <form id="form-datos" class="modal-form">
                <div class="form-group">
                    <label for="input-nombre" class="form-label">Nombre completo *</label>
                    <input type="text" id="input-nombre" name="nombre" class="form-input" required placeholder="Ingresa tu nombre">
                    <span id="error-nombre" class="error-message"></span>
                </div>
                <div class="form-group">
                    <label for="input-correo" class="form-label">Correo electr√≥nico *</label>
                    <input type="email" id="input-correo" name="correo" class="form-input" required placeholder="tu@email.com">
                    <span id="error-correo" class="error-message"></span>
                </div>
                <div class="form-actions">
                    <button type="button" id="cancelar-pedido" class="btn btn-secondary">Cancelar</button>
                    <button type="submit" id="guardar-datos" class="btn btn-primary">
                        Confirmar Pedido
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Panel del Carrito -->
    <div id="cart-backdrop" class="cart-backdrop"></div>
    <aside id="cart-panel" class="cart-panel">
        <div class="cart-header">
            <h3>Tu Carrito de Compras</h3>
            <button id="close-cart" class="close-cart" aria-label="Cerrar carrito">√ó</button>
        </div>
        <div class="cart-content">
            <div id="cart-items" class="cart-items">
                <!-- Items del carrito se cargan aqu√≠ -->
            </div>
            <div class="cart-summary">
                <div class="cart-total">
                    <span>Total:</span>
                    <strong id="cart-total">$0.00</strong>
                </div>
                <div class="cart-actions">
                    <button id="vaciar-carrito" class="btn btn-outline">Vaciar Carrito</button>
                    <button id="pagar-carrito" class="btn btn-primary">Procesar Pago</button>
                </div>
            </div>
        </div>
    </aside>

    <!-- Scripts -->
    <script>
    // Configuraci√≥n de productos
    const products = {
        refrescos: [
            {name: "Coca Cola", price: "$20.00", img: "Cocacola.jpeg", category: "Bebidas"},
            {name: "Sangr√≠a", price: "$20.00", img: "Sangria.jpeg", category: "Bebidas"},
            {name: "Sprite", price: "$20.00", img: "Sprite.jpeg", category: "Bebidas"},
        ],
        snacks: [
            {name: "Tostitos Preparados", price: "$50.00", img: "Tostitos_prep.jpeg", category: "Snacks"},
            {name: "Pepihuates", price: "$25.00", img: "Pepihuates.jpeg", category: "Snacks"},
        ],
        dulces: [
            {name: "Chocolate", price: "$8.00", img: "Chocolate.jpeg", category: "Dulces"},
            {name: "Gomitas", price: "$7.00", img: "Gomitas.jpeg", category: "Dulces"},
        ],
        contacto: [
            {name: "Tel√©fono: 123-456-789", price: "", img: null, type: "contacto"},
            {name: "Correo: info@refresqueria.com", price: "", img: null, type: "contacto"},
            {name: "Direcci√≥n: Av. Principal #123", price: "", img: null, type: "contacto"},
        ],
        sobre: [
            {name: "Somos una refresquer√≠a familiar dedicada a ofrecer los mejores productos frescos y deliciosos.", price: "", img: null, type: "info"},
            {name: "Horario: Lunes a Domingo 8:00 AM - 10:00 PM", price: "", img: null, type: "info"},
            {name: "¬°Vis√≠tanos y descubre por qu√© somos los favoritos del barrio!", price: "", img: null, type: "info"},
        ]
    };

    // Sistema del Carrito
    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];

    function guardarCarrito() {
        localStorage.setItem('carrito', JSON.stringify(carrito));
        actualizarContadorCarrito();
    }

    function agregarAlCarrito(producto) {
        const productoExistente = carrito.find(item => item.name === producto.name);
        
        if (productoExistente) {
            productoExistente.cantidad += 1;
        } else {
            carrito.push({
                ...producto,
                cantidad: 1
            });
        }
        
        guardarCarrito();
        actualizarPanelCarrito();
        mostrarNotificacion('Producto agregado al carrito');
    }

    function quitarDelCarrito(nombreProducto) {
        carrito = carrito.filter(item => item.name !== nombreProducto);
        guardarCarrito();
        actualizarPanelCarrito();
    }

    function actualizarCantidad(nombreProducto, cambio) {
        const producto = carrito.find(item => item.name === nombreProducto);
        if (producto) {
            producto.cantidad += cambio;
            if (producto.cantidad <= 0) {
                quitarDelCarrito(nombreProducto);
            } else {
                guardarCarrito();
                actualizarPanelCarrito();
            }
        }
    }

    function actualizarContadorCarrito() {
        const totalItems = carrito.reduce((total, item) => total + item.cantidad, 0);
        document.getElementById('cart-count').textContent = totalItems;
    }

    function actualizarPanelCarrito() {
        const contenedorItems = document.getElementById('cart-items');
        const totalElemento = document.getElementById('cart-total');
        
        let total = 0;
        contenedorItems.innerHTML = '';

        if (carrito.length === 0) {
            contenedorItems.innerHTML = `
                <div class="empty-cart">
                    <span>üõí</span>
                    <p>Tu carrito est√° vac√≠o</p>
                    <small>Agrega productos desde el men√∫</small>
                </div>
            `;
        } else {
            carrito.forEach(item => {
                const precioNumerico = parseFloat(item.price.replace('$', '')) || 0;
                const subtotal = precioNumerico * item.cantidad;
                total += subtotal;

                const elementoItem = document.createElement('div');
                elementoItem.className = 'cart-item';
                elementoItem.innerHTML = `
                    <div class="cart-item-info">
                        <h4>${item.name}</h4>
                        <span class="cart-item-price">${item.price}</span>
                    </div>
                    <div class="cart-item-controls">
                        <div class="quantity-controls">
                            <button class="qty-btn" onclick="actualizarCantidad('${item.name}', -1)">‚àí</button>
                            <span class="quantity">${item.cantidad}</span>
                            <button class="qty-btn" onclick="actualizarCantidad('${item.name}', 1)">+</button>
                        </div>
                        <button class="remove-btn" onclick="quitarDelCarrito('${item.name}')">
                            üóëÔ∏è
                        </button>
                    </div>
                    <div class="cart-item-subtotal">
                        $${subtotal.toFixed(2)}
                    </div>
                `;
                contenedorItems.appendChild(elementoItem);
            });
        }

        totalElemento.textContent = `$${total.toFixed(2)}`;
        actualizarContadorCarrito();
    }

    // Sistema de Navegaci√≥n
    function showCategory(categoria) {
        const contenedor = document.getElementById('products-container');
        const tituloPagina = document.getElementById('page-title');
        
        // Actualizar men√∫ activo
        document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
        event.currentTarget.classList.add('active');
        
        contenedor.innerHTML = '';
        
        if (categoria === 'inicio') {
            mostrarVistaInicio(contenedor);
            tituloPagina.textContent = 'Bienvenido a EL PORTON';
        } else if (products[categoria]) {
            tituloPagina.textContent = categoria.charAt(0).toUpperCase() + categoria.slice(1);
            if (categoria === 'contacto' || categoria === 'sobre') {
                mostrarInformacion(contenedor, products[categoria]);
            } else {
                mostrarProductos(contenedor, products[categoria]);
            }
        }
        
        // Cerrar sidebar en m√≥viles
        if (window.innerWidth <= 768) {
            document.getElementById('sidebar').classList.remove('active');
        }
    }

    function mostrarVistaInicio(contenedor) {
        contenedor.innerHTML = `
            <div class="welcome-hero">
                <div class="hero-content">
                    <h1>Bienvenido a Refresquer√≠a</h1>
                    <h2>EL PORTON</h2>
                    <p class="hero-description">
                        Somos una refresquer√≠a familiar. Explora nuestras categor√≠as desde la barra lateral 
                        y agrega tus productos favoritos al carrito.
                    </p>
                    <div class="hero-features">
                        <div class="feature">
                            <span>ü•§</span>
                            <h3>Refrescos Fr√≠os</h3>
                            <p>La mejor selecci√≥n de bebidas</p>
                        </div>
                        <div class="feature">
                            <span>üçø</span>
                            <h3>Snacks Deliciosos</h3>
                            <p>Acompa√±a tu bebida</p>
                        </div>
                        <div class="feature">
                            <span>üç¨</span>
                            <h3>Dulces Variados</h3>
                            <p>Para el antojo dulce</p>
                        </div>
                    </div>
                    <div class="promo-section">
                        <h3>Promociones y Novedades</h3>
                        <p>Vis√≠tanos frecuentemente para descubrir nuestras promociones especiales y nuevos productos.</p>
                    </div>
                </div>
            </div>
        `;
    }

    function mostrarProductos(contenedor, productos) {
        if (productos.length === 0) {
            contenedor.innerHTML = '<div class="empty-state">No hay productos disponibles en esta categor√≠a.</div>';
            return;
        }

        const grid = document.createElement('div');
        grid.className = 'products-grid';
        
        productos.forEach(producto => {
            const tarjeta = document.createElement('div');
            tarjeta.className = 'product-card';
            tarjeta.innerHTML = `
                ${producto.img ? `
                    <div class="product-image">
                        <img src="${producto.img}" alt="${producto.name}" loading="lazy">
                    </div>
                ` : ''}
                <div class="product-info">
                    <h3 class="product-name">${producto.name}</h3>
                    ${producto.category ? `<span class="product-category">${producto.category}</span>` : ''}
                    <div class="product-price">${producto.price}</div>
                    <button class="add-to-cart-btn" onclick="agregarAlCarrito(${JSON.stringify(producto).replace(/"/g, '&quot;')})">
                        üõí Agregar al Carrito
                    </button>
                </div>
            `;
            grid.appendChild(tarjeta);
        });
        
        contenedor.appendChild(grid);
    }

    function mostrarInformacion(contenedor, informacion) {
        const lista = document.createElement('div');
        lista.className = 'info-list';
        
        informacion.forEach(item => {
            const elemento = document.createElement('div');
            elemento.className = 'info-item';
            elemento.innerHTML = `
                <div class="info-content">
                    <p>${item.name}</p>
                </div>
            `;
            lista.appendChild(elemento);
        });
        
        contenedor.appendChild(lista);
    }

    function mostrarNotificacion(mensaje) {
        // Crear notificaci√≥n temporal
        const notificacion = document.createElement('div');
        notificacion.className = 'notification';
        notificacion.textContent = mensaje;
        document.body.appendChild(notificacion);
        
        setTimeout(() => {
            notificacion.classList.add('show');
        }, 100);
        
        setTimeout(() => {
            notificacion.classList.remove('show');
            setTimeout(() => {
                document.body.removeChild(notificacion);
            }, 300);
        }, 3000);
    }

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar vista de inicio
        showCategory('inicio');
        actualizarContadorCarrito();
        
        // Menu toggle para m√≥viles
        document.getElementById('menu-toggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
        });
        
        // Carrito toggle
        document.getElementById('ver-carrito').addEventListener('click', function() {
            document.getElementById('cart-panel').classList.add('active');
            document.getElementById('cart-backdrop').classList.add('active');
            actualizarPanelCarrito();
        });
        
        // Cerrar carrito
        document.getElementById('close-cart').addEventListener('click', cerrarCarrito);
        document.getElementById('cart-backdrop').addEventListener('click', cerrarCarrito);
        
        function cerrarCarrito() {
            document.getElementById('cart-panel').classList.remove('active');
            document.getElementById('cart-backdrop').classList.remove('active');
        }
        
        // Vaciar carrito
        document.getElementById('vaciar-carrito').addEventListener('click', function() {
            if (carrito.length > 0) {
                if (confirm('¬øEst√°s seguro de que quieres vaciar el carrito?')) {
                    carrito = [];
                    guardarCarrito();
                    actualizarPanelCarrito();
                    mostrarNotificacion('Carrito vaciado');
                }
            }
        });
        
        // Procesar pago
        document.getElementById('pagar-carrito').addEventListener('click', function() {
            if (carrito.length === 0) {
                mostrarNotificacion('El carrito est√° vac√≠o');
                return;
            }
            document.getElementById('modal-datos').classList.add('active');
        });
        
        // Modal de datos
        document.getElementById('cancelar-datos').addEventListener('click', cerrarModal);
        document.getElementById('cancelar-pedido').addEventListener('click', cerrarModal);
        document.getElementById('modal-overlay').addEventListener('click', cerrarModal);
        
        function cerrarModal() {
            document.getElementById('modal-datos').classList.remove('active');
        }
        
        // Formulario de pedido
        document.getElementById('form-datos').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nombre = document.getElementById('input-nombre').value.trim();
            const correo = document.getElementById('input-correo').value.trim();
            let valido = true;
            
            // Validaciones
            document.getElementById('error-nombre').textContent = '';
            document.getElementById('error-correo').textContent = '';
            
            if (!nombre) {
                document.getElementById('error-nombre').textContent = 'El nombre es obligatorio';
                valido = false;
            }
            
            if (!correo) {
                document.getElementById('error-correo').textContent = 'El correo es obligatorio';
                valido = false;
            } else if (!/^\S+@\S+\.\S+$/.test(correo)) {
                document.getElementById('error-correo').textContent = 'Correo electr√≥nico no v√°lido';
                valido = false;
            }
            
            if (!valido) return;
            
            // Calcular total
            const total = carrito.reduce((sum, item) => {
                const precio = parseFloat(item.price.replace('$', '')) || 0;
                return sum + (precio * item.cantidad);
            }, 0);
            
            // Preparar datos para Firebase
            const datosPedido = {
                nombre: nombre,
                correo: correo,
                productos: carrito.map(item => ({
                    nombre: item.name,
                    cantidad: item.cantidad,
                    precio: item.price
                })),
                total: total.toFixed(2),
                fecha: firebase.firestore.FieldValue.serverTimestamp(),
                estado: 'pendiente'
            };
            
            // Guardar en Firebase
            db.collection("pedidos").add(datosPedido)
                .then(() => {
                    mostrarNotificacion('¬°Pedido realizado con √©xito!');
                    carrito = [];
                    guardarCarrito();
                    actualizarPanelCarrito();
                    cerrarModal();
                    document.getElementById('form-datos').reset();
                })
                .catch(error => {
                    console.error("Error guardando pedido:", error);
                    mostrarNotificacion('Error al procesar el pedido. Intenta nuevamente.');
                });
        });
        
        // Cerrar men√∫ al hacer clic fuera en m√≥viles
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menu-toggle');
            
            if (window.innerWidth <= 768 && 
                sidebar.classList.contains('active') &&
                !sidebar.contains(e.target) && 
                e.target !== menuToggle) {
                sidebar.classList.remove('active');
            }
        });
    });

    // Tema oscuro/claro (mantenido de tu c√≥digo original)
    (function(){
        const input = document.getElementById('theme-toggle');
        const root = document.documentElement;
        const label = document.getElementById('theme-label');
        if(!input || !label) return;
        const stored = localStorage.getItem('theme');
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        function setLabel(theme) {
            label.textContent = theme === 'dark' ? 'Oscuro' : 'Claro';
        }
        const applyTheme = (theme)=>{
            root.classList.remove('dark','light');
            if(theme === 'dark'){
                root.classList.add('dark');
                input.checked = true;
            }
            else if(theme === 'light'){
                root.classList.add('light');
                input.checked = false;
            }
            setLabel(theme);
        };

        if(stored === 'dark' || stored === 'light') applyTheme(stored);
        else applyTheme(prefersDark ? 'dark' : 'light');

        input.addEventListener('change', ()=>{
            const newTheme = input.checked ? 'dark' : 'light';
            applyTheme(newTheme);
            localStorage.setItem('theme', newTheme);
        });
    })();
    </script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAK2ex1uACVSPo_fxlgN_iDBAWlsBvV4RM",
            authDomain: "refresqueriaporton.firebaseapp.com",
            projectId: "refresqueriaporton",
            storageBucket: "refresqueriaporton.firebasestorage.app",
            messagingSenderId: "608366778564",
            appId: "1:608366778564:web:39cf58eb7802c1e0189191",
            measurementId: "G-LW73YBZVPF"
        };

        if(!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
    </script>
</body>
</html>